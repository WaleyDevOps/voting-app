pipeline {
    
    tools {
        maven 'Maven 3.5.4'
    }

    agent any 
    stages {
        stage('Build') { 
            when {
                changeset '**/worker/**'
            }
            steps {
                echo 'Compiling worker app'
                dir('worker'){
                sh 'mvn compile' 
                }
                
            }
        }
        stage('Test') { 
            when {
                changeset '**/worker/**'
            }
            steps {
                echo 'Running unit Test on worker app' 
                dir('worker'){
                sh 'mvn clean test' 
                }
            }
        }
        stage('Package') { 
            when {
                branch 'main'
                changeset '**/worker/**'
            }
            steps {
                echo 'Packaging worker app' 
                dir('worker'){
                sh 'mvn package -DskipTests' 
                archiveArtifacts artifacts: '**/target/*.jar', fingerprint: true
                }
            }
        }
    
    }

    post {
        always {
            echo 'Build pipeline fro worker is completed'
        }
    }

    
}